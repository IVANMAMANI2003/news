events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # Configuraci√≥n de logs
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log;

    # Configuraci√≥n del servidor
    server {
        listen 80;
        server_name localhost;

        # P√°gina principal
        location / {
            root /usr/share/nginx/html;
            index index.html;
            
            # Crear p√°gina HTML simple si no existe
            try_files $uri $uri/ @fallback;
        }

        # Servir archivos de datos
        location /data/ {
            alias /usr/share/nginx/html/data/;
            autoindex on;
            autoindex_exact_size off;
            autoindex_localtime on;
            
            # Headers para descarga de archivos
            add_header Content-Disposition "attachment" always;
        }

        # API simple para estad√≠sticas
        location /api/stats {
            return 200 '{"status": "ok", "message": "API funcionando"}';
            add_header Content-Type application/json;
        }

        # Fallback para crear p√°gina principal
        location @fallback {
            return 200 '<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Scraping de Noticias</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 5px; }
        .content { margin: 20px 0; }
        .stats { background: #ecf0f1; padding: 15px; border-radius: 5px; }
        a { color: #3498db; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì∞ Sistema de Scraping de Noticias</h1>
        <p>Sistema automatizado de recolecci√≥n de noticias de m√∫ltiples fuentes</p>
    </div>
    
    <div class="content">
        <h2>üìä Estado del Sistema</h2>
        <div class="stats">
            <p><strong>Estado:</strong> ‚úÖ Funcionando</p>
            <p><strong>√öltima actualizaci√≥n:</strong> ' + new Date().toLocaleString() + '</p>
        </div>
        
        <h2>üìÅ Archivos de Datos</h2>
        <p>Los archivos CSV y JSON generados est√°n disponibles en:</p>
        <ul>
            <li><a href="/data/">Ver archivos de datos</a></li>
        </ul>
        
        <h2>üîß Fuentes de Noticias</h2>
        <ul>
            <li>Diario Sin Fronteras</li>
            <li>Los Andes</li>
            <li>Pachamama Radio</li>
            <li>Puno Noticias</li>
        </ul>
        
        <h2>‚öôÔ∏è Configuraci√≥n</h2>
        <p>El sistema ejecuta scraping autom√°ticamente cada hora y almacena los datos en PostgreSQL.</p>
    </div>
</body>
</html>';
            add_header Content-Type text/html;
        }
    }
}
